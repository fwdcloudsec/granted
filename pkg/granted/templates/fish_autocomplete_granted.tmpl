# Fish completion for {{ .Program }} (granted)
# Dynamically calls {{ .Program }} --generate-bash-completion to list subcommands and flags

# Disable file completions by default for the granted command
complete -c {{ .Program }} -f

complete -c {{ .Program }} -a '(
    set -l tokens (commandline -opc)
    set -l current (commandline -ct)

    # pass all tokens except the command name, plus --generate-bash-completion
    set -l args
    if test (count $tokens) -gt 1
        set args $tokens[2..-1]
    end

    _CLI_ZSH_AUTOCOMPLETE_HACK=1 {{ .Program }} $args --generate-bash-completion 2>/dev/null
)'
